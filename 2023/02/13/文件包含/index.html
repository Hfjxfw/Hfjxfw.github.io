<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>文件包含 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="文件包含留言 连接数据库查看留言 连接数据库登录 连接数据库注册 连接数据库 代码的重复 留言 查看留言 连接数据库单独的文件 登录 注册 程序开发人员通常会把可重复使用的函数写到单个文件中，在使用某个函数的时候，直接调用此文件，无需再次编写，这种调用文件的过程通常称为包含。程序开发人员都希望代码更加灵活，所以通常会把被包含的文件设置为变量，来进行动态调用，但正是由于这种灵活性，从而导致客户端可以">
<meta property="og:type" content="article">
<meta property="og:title" content="文件包含">
<meta property="og:url" content="http://example.com/2023/02/13/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="文件包含留言 连接数据库查看留言 连接数据库登录 连接数据库注册 连接数据库 代码的重复 留言 查看留言 连接数据库单独的文件 登录 注册 程序开发人员通常会把可重复使用的函数写到单个文件中，在使用某个函数的时候，直接调用此文件，无需再次编写，这种调用文件的过程通常称为包含。程序开发人员都希望代码更加灵活，所以通常会把被包含的文件设置为变量，来进行动态调用，但正是由于这种灵活性，从而导致客户端可以">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-02-13T08:42:17.000Z">
<meta property="article:modified_time" content="2023-02-13T08:49:46.647Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-文件包含" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/02/13/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" class="article-date">
  <time class="dt-published" datetime="2023-02-13T08:42:17.000Z" itemprop="datePublished">2023-02-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      文件包含
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1><p>留言 连接数据库<br>查看留言 连接数据库<br>登录 连接数据库<br>注册 连接数据库</p>
<p>代码的重复</p>
<p>留言</p>
<p>查看留言 连接数据库单独的文件</p>
<p>登录</p>
<p>注册</p>
<p>程序开发人员通常会把可重复使用的函数写到单个文件中，在使用某个函数的时候，直接调用此文件，无需再次编写，这种调用文件的过程通常称为包含。<br>程序开发人员都希望代码更加灵活，所以通常会把被包含的文件设置为变量，来进行动态调用，但正是由于这种灵活性，从而导致客户端可以调用任意文件，造成文件包含漏洞。</p>
<p>文件上传JEG PNG JPEG GlF先上传PNG图片马，然后再包含。</p>
<p>txt png rar</p>
<p>把文件里面的内容当作PHP代码执行。</p>
<p>![img](D:\My Blog\source_posts\文件包含.assets\720c3001be8c4b71b5d6b3e5cc7697f8.png)</p>
<p>文件包含产生原因：</p>
<h2 id="1-web应用实现了动态包含："><a href="#1-web应用实现了动态包含：" class="headerlink" title="1.web应用实现了动态包含："></a>1.web应用实现了动态包含：</h2><p>![image-20220325200649041](D:\My Blog\source_posts\文件包含.assets\66f54be08fb5cdc23dbaef7143596862.png)</p>
<h2 id="2-动态包含的文件路径参数，客户端可控："><a href="#2-动态包含的文件路径参数，客户端可控：" class="headerlink" title="2.动态包含的文件路径参数，客户端可控："></a>2.动态包含的文件路径参数，客户端可控：</h2><p>![image-20220325200859083](D:\My Blog\source_posts\文件包含.assets\240e8f561803e5a59c1f842296dba97d.png)</p>
<p> 几平所有的脚本语言都会提供文件包含功能。文件包含漏洞在PHP Web Application中居多，在JSP&#x2F;ASP&#x2F;ASP.net程序中比较少。以PHP为例，说明文件包含漏洞。</p>
<p>PHP中的文件包含</p>
<p>![img](D:\My Blog\source_posts\文件包含.assets\e5ff8a025e6b9c29cc7c904989643360.png)</p>
<h2 id="语句"><a href="#语句" class="headerlink" title="*语句"></a>*语句</h2><p>PHP中提供了四个文件包含的函数，四个函数之间略有区别。如下</p>
<p>函数 区别<br>include( ) 文件包含失败时，会产生警告，脚本会继续运行。<br>include_once() 与include()功能相同，文件只会被包含一次。require( ) 文件包含失败时，会产生错误，直接结束脚本执行。<br>require_once( ) 与require( )功能相同，文件只会被包含一次。</p>
<p>![image-20220325194627238](D:\My Blog\source_posts\文件包含.assets\1dab31317bccb14004e21c674071b7ee.png)</p>
<p>inc.php被包含了两次</p>
<p>![image-20220325195513215](D:\My Blog\source_posts\文件包含.assets\d906c0c031af5a4f97c2b700fa2ed265.png)</p>
<p>inc.php被包含了一次</p>
<p><strong>![image-20220325195553567](D:\My Blog\source_posts\文件包含.assets\6d3c92227628da84a42b0693879e6016.png)</strong></p>
<h2 id="相关配置"><a href="#相关配置" class="headerlink" title="*相关配置"></a>*相关配置</h2><p>文件包含是PHP的基本功能之一，有本地文件包含和远程文件包含之分(虽然php官网上不是这么解释的)。简单来说，本地文件包含就是可以读取和打开本地文件，远程文件包含（http，ftp，php伪协议）就是可以远程加载文件。我们可以通过php.ini来进行配置。如下<br>allow_url_fopen&#x3D;On&#x2F;Off 本地文件包含(LFI)（开和关都可包含本地文件）<br>allow_url_include&#x3D;On&#x2F;Off 远程文件包含(RFI)</p>
<h4 id="ps："><a href="#ps：" class="headerlink" title="ps："></a><strong>ps</strong>：</h4><p>session_unset()：</p>
<p>释放当前在内存中已经创建的所有$_SESSION变量，但不删除session文件以及不释放对应的session_id</p>
<p>session_destroy()：<br>删除当前用户对应的session文件以及释放sessionid，内存中的$_SESSION变量内容依然保留， 也不会重置会话 cookie</p>
<p>file_exists — 检查文件或目录是否存在,如果由指定的文件或目录存在则返回 true，否则返回 false。</p>
<p>file_get_contents — 将整个文件读入一个字符串,函数返回读取到的数据， 或者在失败时返回 false。</p>
<p>strpos — 查找字符串首次出现的位置,返回 needle 存在于 haystack 字符串起始的位置(独立于 offset)。同时注意字符串位置是从0开始，而不是从1开始的。如果没找到 needle，将返回 false。</p>
<p>define — 定义一个常量</p>
<p>dirname：返回 path 的父目录。 如果在 path 中没有斜线，则返回一个点（‘.’），表示当前目录。否则返回的是把 path 中结尾的&#x2F;component（最后一个斜线以及后面部分）去掉之后的字符串。</p>
<p>set_include_path — 设置include函数中 include_path 配置选项，成功时返回旧的 include_path或者在失败时返回 false。</p>
<p>include</p>
<p>被包含文件先按参数给出的路径寻找，如果没有给出目录（只有文件名）时则按照 include_path指定的目录寻找。如果在 include_path下没找到该文件则 include 最后才在调用脚本文件所在的目录和当前工作目录下寻找。如果最后仍未找到文件则 include 结构会发出一条警告；这一点和require 不同，后者会发出一个致命错误。</p>
<p>如果定义了路径——不管是绝对路径（在 Windows 下以盘符或者 \ 开头，在 Unix&#x2F;Linux 下以 &#x2F; 开头）还是当前目录的相对路径（以 . 或者 .. 开头）——include_path都会被完全忽略。例如一个文件以 ..&#x2F; 开头，则解析器会在当前目录的父目录下寻找该文件。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/02/13/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" data-id="cle2krkau0000mo844nz2153m" data-title="文件包含" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2023/02/07/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">PHP反序列化</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/02/13/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">文件包含</a>
          </li>
        
          <li>
            <a href="/2023/02/07/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">PHP反序列化</a>
          </li>
        
          <li>
            <a href="/2023/02/05/%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/">图片隐写</a>
          </li>
        
          <li>
            <a href="/2023/02/05/crc%E6%A0%A1%E9%AA%8C%E4%B8%8E%E5%8E%8B%E7%BC%A9%E5%8C%85/">crc校验与压缩包</a>
          </li>
        
          <li>
            <a href="/2023/02/05/PHP%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">PHP命令执行漏洞</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>